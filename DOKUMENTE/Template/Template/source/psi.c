#include <stdint.h>
#include <stdio.h>
#include "hwconfig.h"

#include "psi.h"


int psiInit( void ){
	PSI_INIT;
	return 0;
}


	


int psiTransfer( int32_t outdata, int32_t* indata ){

    PSI_ENABLE_WRITE;
//printf( "a DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_SET_REQ;
//printf( "b DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_WAIT_ACK_SET;
//printf( "c DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_WRITE_DATA( outdata );
//printf( "d DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_CLR_REQ;
//printf( "e DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_WAIT_ACK_CLR;
//printf( "f DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );

    PSI_WAIT_RESULT_SET;
//printf( "g DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );

    PSI_ENABLE_READ;
//printf( "h DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_SET_REQ;
//printf( "i DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_WAIT_ACK_SET;
//printf( "j DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_READ_DATA( *indata );
//printf( "k DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_CLR_REQ;
//printf( "l DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );
    PSI_WAIT_ACK_CLR;
//printf( "m DIR0=%08X DIR1=%08X DIR2=%08X PIN0=%08X PIN1=%08X PIN2=%08X\n", FIO0DIR, FIO1DIR, FIO2DIR, FIO0PIN, FIO1PIN, FIO2PIN );

    return 0;
}
